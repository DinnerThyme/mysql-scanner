package protocol

import (
	"github.com/stretchr/testify/assert"
	"testing"
)

const sample = "\x0A\x38\x2E\x30\x2E\x32\x32\x00\x3B\x00\x00\x00\x65\x05\x60\x11\x12\x0C\x0A\x17\x00\xFF\xFF\xFF\x02\x00\xFF\xC7\x15\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x69\x60\x35\x05\x4C\x51\x6D\x2F\x5C\x1D\x38\x7B\x00\x63\x61\x63\x68\x69\x6E\x67\x5F\x73\x68\x61\x32\x5F\x70\x61\x73\x73\x77\x6F\x72\x64\x00"
//var ExampleGreeting = "\x50\x00\x00\x00\x0a\x35\x2e\x36\x2e\x34\x2d\x6d\x37\x2d\x6c\x6f\x67\x00\x56\x0a\x00\x00\x52\x42\x33\x76\x7a\x26\x47\x72\x00\xff\xff\x08\x02\x00\x0f\xc0\x15\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x2b\x79\x44\x26\x2f\x5a\x5a\x33\x30\x35\x5a\x47\x00\x6d\x79\x73\x71\x6c\x5f\x6e\x61\x74\x69\x76\x65\x5f\x70\x61\x73\x73\x77\x6f\x72\x64\x00"

func TestGreetingUnPack(t *testing.T) {
	greet := Greeting{}
	err := greet.UnPack([]byte(sample))
	assert.Nil(t, err)
	assert.Equal(t, 59, int(greet.ConnId))
	assert.Equal(t, 255, int(greet.CharacterSet))
	assert.Equal(t, "caching_sha2_password", greet.AuthName)
	assert.Equal(t, 10, int(greet.ProtoVersion))
	assert.Equal(t, "8.0.22", greet.SvrVersion)
	assert.Equal(t, 2, int(greet.Status))
	assert.Equal(t, CapabilityFlag(0xc7ffffff), greet.Capability)
}

func TestGreeting_String(t *testing.T) {
	greet := Greeting{}
	greet.String()
}